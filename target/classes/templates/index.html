<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ч╜Сщб╡хЙкш┤┤цЭ┐</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTggNEwyNCAyVjI2TDggMjhWNFoiIGZpbGw9IiM1YTlmZTYiLz4KPHBhdGggZD0iTTI0IDJMMjYgNlYzMEwyNCAyNlYyWiIgZmlsbD0iIzRhOTBlMiIvPgo8cGF0aCBkPSJNOCA0TDI0IDJMMjYgNkwxMCA4TDggNFoiIGZpbGw9IiM2YWI3ZmYiLz4KPHJlY3QgeD0iMTIiIHk9IjgiIHdpZHRoPSI4IiBoZWlnaHQ9IjMiIHJ4PSIxIiBmaWxsPSIjZmZmZmZmIi8+CjxsaW5lIHgxPSIxMCIgeTE9IjE1IiB4Mj0iMjIiIHkyPSIxNSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjIiLz4KPGxpbmUgeDE9IjEwIiB5MT0iMTkiIHgyPSIyMiIgeTI9IjE5IiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiIvPgo8bGluZSB4MT0iMTAiIHkxPSIyMyIgeDI9IjE4IiB5Mj0iMjMiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPgo=">
    <link rel="stylesheet" th:href="@{/css/style.css?v=}+${@environment.getProperty('app.version','1.0.0')}">
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 10px;">
                    <path d="M8 4L24 2V26L8 28V4Z" fill="#5a9fe6"/>
                    <path d="M24 2L26 6V30L24 26V2Z" fill="#4a90e2"/>
                    <path d="M8 4L24 2L26 6L10 8L8 4Z" fill="#6ab7ff"/>
                    <rect x="12" y="8" width="8" height="3" rx="1" fill="#ffffff"/>
                    <line x1="10" y1="15" x2="22" y2="15" stroke="#ffffff" stroke-width="2"/>
                    <line x1="10" y1="19" x2="22" y2="19" stroke="#ffffff" stroke-width="2"/>
                    <line x1="10" y1="23" x2="18" y2="23" stroke="#ffffff" stroke-width="2"/>
                </svg>
                ч╜Сщб╡хЙкш┤┤цЭ┐
            </h1>
            <div class="header-actions">
                <div class="stats">
                    <span>цА╗шоб: <span th:text="${itemCount}">0</span> цЭб</span>
                </div>
                <div class="action-buttons" th:if="${items != null and not #lists.isEmpty(items)}">
                    <button class="btn btn-danger" onclick="showClearModal()">ц╕Ечй║цЙАцЬЙ</button>
                </div>
            </div>
        </header>

        <div class="add-section">
            <!-- щФЩшппф┐бцБпцШ╛чд║ -->
            <div th:if="${error}" class="error-message" th:text="${error}">
                щФЩшппф┐бцБп
            </div>
            <form th:action="@{/add}" method="post" class="add-form">
                <textarea name="content" placeholder="ш╛УхЕехЙкш┤┤цЭ┐хЖЕхо╣..." rows="3" required></textarea>
                <button type="submit" class="btn btn-primary">ц╖╗хКахЖЕхо╣</button>
            </form>
        </div>

        <!-- чнЫщАЙхМ║хЯЯ -->
        <div class="filter-section">
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="timeFilter">цЧ╢щЧ┤чнЫщАЙя╝Ъ</label>
                    <select id="timeFilter" onchange="filterByTime()">
                        <option value="all">хЕищГицЧ╢щЧ┤</option>
                        <option value="today">ф╗Кхдй</option>
                        <option value="yesterday">цШихдй</option>
                        <option value="week">цЬмхСи</option>
                        <option value="month">цЬмцЬИ</option>
                        <option value="custom">шЗкхоЪф╣ЙцЧ╢щЧ┤</option>
                    </select>
                    <div id="customTimeRange" class="custom-time-range" style="display: none;">
                        <input type="date" id="startDate" onchange="filterByTime()">
                        <span> шЗ│ </span>
                        <input type="date" id="endDate" onchange="filterByTime()">
                    </div>
                </div>
                <div class="filter-group">
                    <select id="searchType" onchange="debouncedApplyFilters()">
                        <option value="content">цМЙхЖЕхо╣цРЬч┤в</option>
                        <option value="annotation">цМЙцаЗц│ицРЬч┤в</option>
                    </select>
                    <input type="text" id="searchInput" placeholder="цРЬч┤вхЙкш┤┤цЭ┐хЖЕхо╣..." class="search-input" oninput="debouncedApplyFilters()">
                </div>
                <div id="performanceTip" class="performance-tip" style="display: none;"></div>
            </div>
        </div>

        <div class="items-section" th:if="${items != null and not #lists.isEmpty(items)}">
            <div class="section-header">
                <h2>хЙкш┤┤цЭ┐хЖЕхо╣</h2>
                <div class="bulk-actions">
                    <label class="checkbox-container">
                        <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                        <span class="checkmark"></span>
                        <span>хЕищАЙ</span>
                    </label>
                    <button class="btn btn-sm btn-danger" id="deleteSelected" onclick="deleteSelectedItems()" disabled>хИащЩдщАЙф╕н</button>
                </div>
            </div>
            <div class="items-list">
                <div th:each="item : ${items}" class="item-card" th:id="'item-' + ${item.id}">
                    <div class="item-header">
                        <div class="item-left">
                            <label class="checkbox-container">
                                <input type="checkbox" class="item-checkbox" th:value="${item.id}" onchange="updateBulkActions()">
                                <span class="checkmark"></span>
                            </label>
                            <span class="item-number" th:text="'#' + ${item.itemNumber}">#1</span>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-sm btn-copy" th:data-content="${item.content}" onclick="copyToClipboard(this)">хдНхИ╢</button>
                            <button class="btn btn-sm btn-annotate" th:onclick="'toggleAnnotation(' + ${item.id} + ')'" th:data-annotation="${item.annotation}">цаЗц│и</button>
                            <button class="btn btn-sm btn-danger" th:onclick="'deleteItem(' + ${item.id} + ')'">хИащЩд</button>
                        </div>
                    </div>
                    <div class="item-content">
                        <div class="content-preview" th:id="'preview-' + ${item.id}">
                            <span th:text="${#strings.abbreviate(item.content, 100)}">хЖЕхо╣щвДшзИ</span>
                            <button th:if="${#strings.length(item.content) > 100}" 
                                    class="btn-toggle" 
                                    th:onclick="'toggleContent(' + ${item.id} + ')'">х▒Хх╝А</button>
                        </div>
                        <div class="content-full" th:id="'full-' + ${item.id}" style="display: none;">
                            <pre th:text="${item.content}">хоМцХ┤хЖЕхо╣</pre>
                            <button class="btn-toggle" th:onclick="'toggleContent(' + ${item.id} + ')'">цФ╢ш╡╖</button>
                        </div>
                    </div>
                    <div class="item-meta">
                        <small th:text="${#temporals.format(item.createdAt, 'yyyy-MM-dd HH:mm')}">хИЫх╗║цЧ╢щЧ┤</small>
                    </div>
                    <div th:if="${item.annotation != null and item.annotation != ''}" class="item-annotation">
                        <span class="annotation-label">цаЗц│ия╝Ъ</span>
                        <span class="annotation-text" th:text="${item.annotation}">цаЗц│ихЖЕхо╣</span>
                    </div>
                    <div class="annotation-editor" th:id="'annotation-editor-' + ${item.id}" style="display: none;">
                        <textarea class="annotation-input" th:id="'annotation-input-' + ${item.id}" placeholder="ц╖╗хКацаЗц│ишп┤цШО..."></textarea>
                        <div class="annotation-actions">
                            <button class="btn btn-sm btn-primary" th:onclick="'saveAnnotation(' + ${item.id} + ')'">ф┐ЭхнШ</button>
                            <button class="btn btn-sm btn-secondary" th:onclick="'cancelAnnotation(' + ${item.id} + ')'">хПЦц╢И</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="empty-state" th:if="${items == null or #lists.isEmpty(items)}">
            <div class="empty-icon">ЁЯУЛ</div>
            <p>цЪВцЧахЙкш┤┤цЭ┐хЖЕхо╣</p>
            <p class="empty-hint">хЬиф╕КцЦ╣ш╛УхЕецбЖф╕нц╖╗хКачммф╕АцЭбхЖЕхо╣хРзя╝Б</p>
        </div>
    </div>

    <!-- хИащЩдчбошодцибцАБцбЖ -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>чбошодхИащЩд</h3>
            <p>чбохоЪшжБхИащЩдш┐ЩцЭбхЙкш┤┤цЭ┐хЖЕхо╣хРЧя╝Я</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">хПЦц╢И</button>
                <button id="confirmDelete" class="btn btn-danger">хИащЩд</button>
            </div>
        </div>
    </div>

    <!-- ц╕Ечй║чбошодцибцАБцбЖ -->
    <div id="clearModal" class="modal">
        <div class="modal-content">
            <h3>чбошодц╕Ечй║</h3>
            <p>чбохоЪшжБц╕Ечй║цЙАцЬЙхЙкш┤┤цЭ┐хЖЕхо╣хРЧя╝ЯцндцУНф╜Ьф╕НхПпцБвхдНя╝Б</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeClearModal()">хПЦц╢И</button>
                <form th:action="@{/clear}" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-danger">чбошодц╕Ечй║</button>
                </form>
            </div>
        </div>
    </div>

    <!-- цЙ╣щЗПхИащЩдчбошодцибцАБцбЖ -->
    <div id="bulkDeleteModal" class="modal">
        <div class="modal-content">
            <h3>чбошодцЙ╣щЗПхИащЩд</h3>
            <p>чбохоЪшжБхИащЩдщАЙф╕нчЪД <span id="selectedCount">0</span> цЭбхЙкш┤┤цЭ┐хЖЕхо╣хРЧя╝Я</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeBulkDeleteModal()">хПЦц╢И</button>
                <button id="confirmBulkDelete" class="btn btn-danger">чбошодхИащЩд</button>
            </div>
        </div>
    </div>

    <script th:src="@{/js/clipboard.js?v=}+${@environment.getProperty('app.version','1.0.0')}"></script>
</body>
</html>